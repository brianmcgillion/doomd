# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Critical Warning: Literate Configuration

**ALL edits go in `config.org`, NEVER in `config.el`.**

`config.el` is auto-generated by tangling `config.org` via Doom's `:config literate` module. Direct edits will be overwritten on `doom sync`.

## Commands

```bash
doom sync      # Run after ANY config changes (tangles, installs packages, rebuilds)
doom upgrade   # Update Doom and all packages
doom doctor    # Diagnose configuration issues
doom env       # Regenerate environment snapshot
```

## File Purposes

| File | Edit? | Purpose |
|------|-------|---------|
| `config.org` | **YES** | Literate source of truth with org-mode + embedded elisp |
| `config.el` | NO | Auto-generated, never edit |
| `init.el` | YES | Enable/disable Doom modules via `doom!` macro |
| `packages.el` | YES | Declare packages via `package!` macro (no config here) |
| `elfeed-config.el` | YES | Standalone RSS/elfeed scoring config |

## Doom Conventions

Use Doom macros where still applicable:
- `setq!` not `setq`
- `map!` not `define-key`

Use standard Emacs for deferred loading (Doom equivalents are deprecated):
- `with-eval-after-load` not `after!`
- `use-package` not `use-package!`

Wrap all package configuration in `with-eval-after-load` blocks:
```elisp
(with-eval-after-load 'org
  (setq! org-directory "~/Documents/org/"))
```

## Code Style

- Custom functions use `bmg/` prefix
- Sections delimited with `;;; BEGIN_SectionName` / `;;; END_SectionName` markers
- All elisp files need `;;; filename.el -*- lexical-binding: t; -*-` header
- Config.org uses `#+BEGIN_SRC emacs-lisp` blocks for code

## Key Architecture Notes

- **No Evil mode** - Uses standard Emacs keybindings
- **Corfu + Vertico** for completion (not Company/Ivy)
- **LSP + tree-sitter** for all supported languages
- **Format on save** enabled via `(format +lsp +onsave)`
- **Org-roam** for Zettelkasten at `~/Documents/org/roam/`
- **GitHub Copilot** for inline completions via `copilot.el`
- **API keys** stored in `~/.authinfo.gpg`

## LSP Servers

- Nix: `nixd` with flake expressions pointing to `~/.dotfiles`
- C/C++: `clangd` with background indexing and clang-tidy
- Others: Standard LSP servers

## Testing Changes

1. Edit `config.org`
2. Run `doom sync`
3. Restart Emacs or `M-x doom/reload`
4. Verify with `doom doctor`

See `.github/copilot-instructions.md` for comprehensive details on modules, keybindings, and org-mode configuration.
